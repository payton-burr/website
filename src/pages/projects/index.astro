---
import Layout from "../../layouts/Layout.astro";
import Nav from "../../ui/Nav.astro";
import Link from "../../ui/Link.astro";
import Projects from "../../ui/Projects.astro";

// react component
import ThemeToggle from "../../ui/ThemeToggle";

// export const prerender = false;

const response = await fetch("https://api.github.com/graphql", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${import.meta.env.GITHUB_TOKEN}`,
  },
  body: JSON.stringify({
    query: `query {
      user(login: "payton-burr") {
    pinnedItems(first: 6) {
      totalCount
      edges {
        node {
          ... on Repository {
            name
            id
            url
            description
            languages(first: 10) {
              edges {
                node {
                  name
                }
              }
            }
          }
        }
      }
    }
  }
    }`,
  }),
});

const { data } = await response.json();
const { user } = data;

const pinnedItems = user.pinnedItems.edges.map(({ node }) => node);
---

<Layout title="Projects">
  <h1 class="mb-8">Projects</h1>
  <Nav class="flex items-center justify-end gap-3 mb-8">
    <ThemeToggle client:only="react" />
    <Link href="/" text="About" />
    <Link current href="/projects" text="Projects" />
    <Link href="/posts" text="Posts" />
  </Nav>
  <Projects pinnedItems={pinnedItems} />
</Layout>
