---
import Layout from "../../layouts/Layout.astro";
import Nav from "../../ui/Nav.astro";
import Link from "../../ui/Link.astro";
import PostCard from "../../ui/PostCard.astro";

import { formatBlog } from "../../utils/formatBlog";

export async function getStaticPaths() {
  return [
    {
      params: { tags: "JavaScript" },
      props: { name: "JavaScript" },
    },
    {
      params: { tags: "Utility" },
      props: { name: "Utility" },
    },
    {
      params: { tags: "Productivity" },
      props: { name: "Productivity" },
    },
  ];
}

const { tags } = Astro.params;
const { name } = Astro.props;

const allPosts = await Astro.glob("../posts/*.md");
const formattedPosts = formatBlog(allPosts);

const taggedPosts = formattedPosts.filter(
  (post) => post.frontmatter.tags[0] === tags
);
---

<Layout title={name}>
  <h1 class="mb-8">"{name}" Related Posts</h1>
  <Nav class="flex items-center justify-end gap-3 mb-8">
    <Link href="/" text="About" />
    <Link current href="/posts" text="Posts" />
    <Link href="https://github.com/payton-burr" target="_blank" text="Github" />
  </Nav>
  <section aria-label={`${name} Related Posts`}>
    {
      taggedPosts.map((post) => (
        <PostCard frontmatter={post.frontmatter} url={post.url} />
      ))
    }
  </section>
</Layout>
